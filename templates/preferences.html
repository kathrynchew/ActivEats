{% extends 'base.html' %}
{% block title %}Preferences{% endblock %}
{% block content %}
<h1>{{ session['username'] }}'s Profile</h1>
<hr>

<div class="col-sm-4">
<ul class="list-group" id="pref-stuff">
  <li class="list-group-item active"><b>DIETARY PREFERENCES:</b> <button id="editPrefs" type="button" class="btn btn-light btn-sm float-right">Edit</button></li>

    {% if user_info.preferences|length > 0 %}
        {% for pref in user_info.preferences %}
            <li class="list-group-item">{{ pref.category.category_name }}</li>
        {% endfor %}
    {% else %}
      <li class="list-group-item">You have not specified any dietary preferences.</li>
    {% endif %}
</ul>
</div>
<hr>
<h3>Login Information:</h3>
    <b>username:</b> {{ user_info.username }}<br>
    <b>email address:</b> {{ user_info.email }}

<script type="text/javascript">
let $jq = jQuery.noConflict();

function editPreferences(evt) {

    document.querySelector("#pref-stuff").innerHTML = '<form id="update_pref_form" action="/preferences/edit" method="POST"><div class="form-group form-check" id="user-preferences" aria-describedby="preferenceHelp"><li class="list-group-item"><input type="checkbox" class="form-check-input" id="pref-vegetarian" name="prefs" value="Vegetarian"><label class="form-check-label" for="exampleCheck1">Vegetarian</label></li><li class="list-group-item"><input type="checkbox" class="form-check-input" id="pref-vegan" name="prefs" value="Vegan"><label class="form-check-label" for="exampleCheck1">Vegan</label></li><li class="list-group-item"><input type="checkbox" class="form-check-input" id="pref-glutenfree" name="prefs" value="Gluten Free"><label class="form-check-label" for="exampleCheck1">Gluten Free</label></li><li class="list-group-item"><input type="checkbox" class="form-check-input" id="pref-lowcarb" name="prefs" value="Low-Carb"><label class="form-check-label" for="exampleCheck1">Low-Carb</label></li><li class="list-group-item"><input type="checkbox" class="form-check-input" id="pref-lowcal" name="prefs" value="Low Calorie"><label class="form-check-label" for="exampleCheck1">Low Calorie</label></li></div><input type="submit" id="setPrefs"></form>';

    document.querySelector("#setPrefs").addEventListener('click', submitPreferences)
}

function submitPreferences(evt) {
    console.log('butt worm');
    evt.preventDefault();

    let prefs = []
    $("input:checkbox[name=prefs]:checked").each(function(){
        prefs.push($(this).val());
    });

    console.log(prefs);

    $jq.post("/preferences/edit", {'prefs': prefs}, displayPreferences);
}


function displayPreferences(results) {

    console.log("ONE LAST BUTTS")
    let user_info = results;
    console.log(user_info);

    document.querySelector("#pref-stuff").innerHTML = '<li class="list-group-item active"><b>DIETARY PREFERENCES:</b> <button id="edit-prefs" type="button" class="btn btn-light btn-sm float-right">Edit</button></li>{% if ' + user_info '.preferences|length > 0 %}{% for pref in ' + user_info + '.preferences %}<li class="list-group-item">{{ pref.category.category_name }}</li>{% endfor %}{% else %}<li class="list-group-item">You have not specified any dietary preferences.</li>{% endif %}';

    document.querySelector("#editPrefs").addEventListener('click', editPreferences);
}

console.log("BRO");

document.querySelector("#editPrefs").addEventListener('click', editPreferences);
console.log("YOOOOOOOOBRO");

</script>
{% endblock %}